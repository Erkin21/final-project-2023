<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Showcase 2023</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/pcStyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body style="background-color: #8b0000">
    <div class="front-page">
      <!-- Title Start -->
      <h1 class="title">Gaming Showcase 2023</h1>
      <h2 class="logo"><img src="gameController.png" alt="Logo" /></h2>

      <!-- NAV BAR START -->
      <div class="topnav" id="myTopnav">
        <div class="myLinks">
          <!-- Add your navigation links here -->
          <a href="index.html" id="homeButton">Home</a>
          <a href="showcase.html">Gaming Showcase</a>
          <a href="pcExclusive.html" class="active">PC Exclusive</a>
          <a href="ps5exclusive.html">PS5 Exclusive</a>
          <a href="xbox.html">Xbox Exclusive</a>
          <a href="switch.html">Switch Exclusive</a>

          <!-- Search bar section -->
          <a class="search-container">
            <input type="text" id="searchInput" placeholder="Search Games..." />
          </a>

          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
      </div>

      <!-- Purpose of Website START -->
      <div class="purpose">
        <h2>PC Exclusive</h2>
        <p>
          Here you will find all the PC games that are exclusively coming in
          2023
        </p>
      </div>

      <!-- Game Slideshow/Carosel Here -->
      <!-- Game #1 -->
      <div class="slideshow-container">
        <div id="carousel-PC-1" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PC-1"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-1"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-1"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/9OosC1E8TVM"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://assetsio.reedpopcdn.com/-1617958160495.jpg?width=1200&height=1200&fit=bounds&quality=70&format=jpg&auto=webp"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://www.dexerto.com/cdn-cgi/image/width=3840,quality=75,format=auto/https://editors.dexerto.com/wp-content/uploads/2021/09/04/PoE-2-release-date.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PC-1"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PC-1"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Path of Exile 2</h3>
          <p class="summary">
            Path of Exile 2 (initially referred to as Path of Exile 4.0) is an
            upcoming expansion for Path of Exile. It was officially announced by
            Grinding Gear Games on November 15, 2019, during ExileCon[1]...
          </p>
          <a href="https://pathofexile2.com/" class="gameLink" target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.pathofexile.com/account/create"
            class="gameLink"
            target="_blank"
            >Free Download</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Path-of-Exile-2">
              <span class="fa fa-star" id="star1-Path-of-Exile-2" onclick="rate('1', 'Path of Exile 2')"></span>
              <span class="fa fa-star" id="star2-Path-of-Exile-2" onclick="rate('2', 'Path of Exile 2')"></span>
              <span class="fa fa-star" id="star3-Path-of-Exile-2" onclick="rate('3', 'Path of Exile 2')"></span>
              <span class="fa fa-star" id="star4-Path-of-Exile-2" onclick="rate('4', 'Path of Exile 2')"></span>
              <span class="fa fa-star" id="star5-Path-of-Exile-2" onclick="rate('5', 'Path of Exile 2')"></span>
              <span class="rating-number" id="numRatings-Path-of-Exile-2">(0)</span> 
            </div>      
          </div>          

        </div>
      </div>

      <!-- Game #2 -->
      <div class="slideshow-container">
        <div id="carousel-PC-2" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PC-2"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-2"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-2"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/v1HBheDwalo"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://lwi.nexon.com/hp/brand/main_0517/pop_gallery4.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://lwi.nexon.com/hp/brand/main_0517/pop_gallery1.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PC-2"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PC-2"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Warhaven</h3>
          <p class="summary">
            Warhaven is an free-to-play PVP combat game that seeks to add a
            tactical element to the carnage of medieval battles.
          </p>
          <a
            href="https://www.nexon.com/warhaven/en/main"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://store.steampowered.com/app/2107670/Warhaven/"
            class="gameLink"
            target="_blank"
            >Add to Wishlist</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Warhaven">
              <span class="fa fa-star" id="star1-Warhaven" onclick="rate('1', 'Warhaven')"></span>
              <span class="fa fa-star" id="star2-Warhaven" onclick="rate('2', 'Warhaven')"></span>
              <span class="fa fa-star" id="star3-Warhaven" onclick="rate('3', 'Warhaven')"></span>
              <span class="fa fa-star" id="star4-Warhaven" onclick="rate('4', 'Warhaven')"></span>
              <span class="fa fa-star" id="star5-Warhaven" onclick="rate('5', 'Warhaven')"></span>
              <span id="numRatings-Warhaven">(0)</span> 
            </div>      
          </div>          

        </div>
      </div>

      <!-- Game #3 -->
      <div class="slideshow-container">
        <div id="carousel-PC-3" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PC-3"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-3"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PC-3"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/8M1X1PzCwWI"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://blog.playstation.com/tachyon/2022/06/281126d9ff32aeb3a6433e1fad507b0929145adf.jpg?resize=1088%2C612&crop_strategy=smart&zoom=1.5"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://attackofthefanboy.com/wp-content/uploads/2022/06/Eternights.jpgs_.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PC-3"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PC-3"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Eternights</h3>
          <p class="summary">
            Eternights is a dating-action game where you try to make the most
            out of life during the apocalypse. So you scavenge for supplies,
            explore dungeons… and go on dates.
          </p>
          <a
            href="https://www.studiosai.dev/eternights"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://store.steampowered.com/app/1402110/Eternights/"
            class="gameLink"
            target="_blank"
            >Add to Wishlist</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Eternights">
              <span class="fa fa-star" id="star1-Eternights" onclick="rate('1', 'Eternights')"></span>
              <span class="fa fa-star" id="star2-Eternights" onclick="rate('2', 'Eternights')"></span>
              <span class="fa fa-star" id="star3-Eternights" onclick="rate('3', 'Eternights')"></span>
              <span class="fa fa-star" id="star4-Eternights" onclick="rate('4', 'Eternights')"></span>
              <span class="fa fa-star" id="star5-Eternights" onclick="rate('5', 'Eternights')"></span>
              <span id="numRatings-Eternights">(0)</span> 
            </div>      
          </div> 

        </div>       
      </div>

      <!-- About us section -->
      <div class="purpose">
        <h2>About Us</h2>
        <p>Made by: Erkin Abdullaev, Tafhim Khan, Bodrye Kamdem</p>
      </div>
    </div>

    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>

    <!-- rating backend-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { getFirestore, doc, collection, addDoc, getDoc, query, where, runTransaction } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
      
      // Firebase configuration details
      const firebaseConfig = {
        apiKey: "AIzaSyDpNUEId6oedAblTKRQh9ZHj76D1IIzlyY",
        authDomain: "gaming-showcase.firebaseapp.com",
        projectId: "gaming-showcase",
        storageBucket: "gaming-showcase.appspot.com",
        messagingSenderId: "918009808163",
        appId: "1:918009808163:web:3bc3ffb886b1114a93b896",
        measurementId: "G-6V83DP6L23"
      };
    
      // initialize Firebase and check if any Firebase apps have been initialized yet
      let app;
      if (!getApps().length) { 
        app = initializeApp(firebaseConfig);
      }
      const analytics = getAnalytics(app);
      const db = getFirestore(app);
      
      // Remove spaces from the game title to use in HTML element IDs
      function toHtmlId(gameTitle) {
          return gameTitle.replace(/\W+/g, "-");
      }
      
      // handles game rating
      function rate(starNumber, gameTitle) {
        let i;
        let gameTitleId = toHtmlId(gameTitle);
        
        
        // First, clear all stars
        for (i = 5; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star';
        }

        // Then, highlight the number of stars the user selected
        for (i = starNumber; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star checked';
        }

        // finally, update the rating in the Firestore database
        updateRating(gameTitle, starNumber).catch(console.error);
      }

      // Updates rating to server when user clicks
      async function updateRating(gameTitle, rating) {
        const gameTitleId = toHtmlId(gameTitle);
        const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);

        // Temporarily updates the number of ratings displayed on the page, before making the change to Firestore
        const currentCount = Number(numRatingsElement.textContent.replace(/[()]/g, ""));
        numRatingsElement.textContent = `(${currentCount + 1})`; // Temporarily increment the counter

        const ratingRef = doc(db, "ratings", gameTitle);
        try {
          const newCount = await runTransaction(db, async (transaction) => {
            const ratingDoc = await transaction.get(ratingRef);
            if (!ratingDoc.exists()) {
              await setDoc(ratingRef, { totalRating: Number(rating), count: 1 });
              return 1;
            } else {
              const newTotalRating = ratingDoc.data().totalRating + Number(rating);
              const newCount = ratingDoc.data().count + 1;
              transaction.update(ratingRef, { totalRating: newTotalRating, count: newCount });
              return newCount;
            }
          });
          numRatingsElement.textContent = `(${newCount})`; // Update the counter to the actual new count
        } catch (error) {
          console.error('Failed to update rating:', error);
          numRatingsElement.textContent = `(${currentCount})`; // Revert to the original count if there was an error
        }
      }

      async function fetchRating(gameTitle) {
        const ratingRef = doc(db, "ratings", gameTitle);
        const ratingSnap = await getDoc(ratingRef);
        if (ratingSnap.exists()) {
          const gameTitleId = toHtmlId(gameTitle);
          const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);
          if (numRatingsElement) {
              numRatingsElement.textContent = `(${ratingSnap.data().count})`;
          }
          return Math.round(ratingSnap.data().totalRating / ratingSnap.data().count);
        }
        return 0;
      }

      async function setRatingStars(gameTitle) {
        let gameTitleId = toHtmlId(gameTitle);
        let rating = await fetchRating(gameTitle).catch(console.error);
        let i;
        for (i = rating; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          if (starElement) {
            starElement.className = 'fa fa-star checked';
          }
        }
      }

      window.rate = rate;
      window.onload = function() {
        setRatingStars("Path of Exile 2");
        setRatingStars("Warhaven");
        setRatingStars("Eternights");
      };
    </script>

  </body>
</html>
