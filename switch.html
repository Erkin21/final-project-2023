<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Showcase 2023</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/switchStyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body style="background-color: #00c3c3">
    <div class="front-page">
      <!-- Title Start -->
      <h1 class="title">Gaming Showcase 2023</h1>
      <h2 class="logo"><img src="gameController.png" alt="Logo" /></h2>

      <!-- NAV BAR START -->
      <div class="topnav" id="myTopnav">
        <div class="myLinks">
          <!-- Add your navigation links here -->
          <a href="index.html" id="homeButton">Home</a>
          <a href="showcase.html">Gaming Showcase</a>
          <a href="pcExclusive.html">PC Exclusive</a>
          <a href="ps5exclusive.html">PS5 Exclusive</a>
          <a href="xbox.html">Xbox Exclusive</a>
          <a href="switch.html" class="active">Switch Exclusive</a>

          <!-- Search bar section -->
          <a class="search-container">
            <input type="text" id="searchInput" placeholder="Search Games..." />
          </a>

          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
      </div>

      <!-- Purpose of Website START -->
      <div class="purpose">
        <h2>Switch Exclusive</h2>
        <p>
          Here you will find all the Switch games that are exclusively coming in
          2023
        </p>
      </div>

      <!-- Game Slideshow/Carosel Here -->
      <!-- Game #1 -->
      <div class="slideshow-container">
        <div id="carousel-switch-1" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-switch-1"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-1"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-1"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/oAFr2iTy2sg"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="images/5174fbd9bcc3a300ff65c0be95ea3d8f.webp"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="images/hero-large-up-2x.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-switch-1"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-switch-1"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Detective Pikachu Returns</h3>
          <p class="summary">
            Arriving just in time to promote the next Detective Pikachu movie in
            2024, here's a welcome game where talking Pokemon is actually a
            thing outside of a certain Meowth. Detective Pikachu Returns will
            feature more mysteries to solve, and more Pikachu deductions not
            voiced by Ryan Reynolds. Get your thinking hats and solve cases in
            Ryme City with your partner Tim Goodman in this upcoming cinematic
            adventure game.
          </p>
          <a
            href="https://detectivepikachu.pokemon.com/en-us/"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.nintendo.com/store/products/detective-pikachu-returns-switch/"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Detective-Pikachu-Returns">
              <span class="fa fa-star" id="star1-Detective-Pikachu-Returns" onclick="rate('1', 'Detective Pikachu Returns')"></span>
              <span class="fa fa-star" id="star2-Detective-Pikachu-Returns" onclick="rate('2', 'Detective Pikachu Returns')"></span>
              <span class="fa fa-star" id="star3-Detective-Pikachu-Returns" onclick="rate('3', 'Detective Pikachu Returns')"></span>
              <span class="fa fa-star" id="star4-Detective-Pikachu-Returns" onclick="rate('4', 'Detective Pikachu Returns')"></span>
              <span class="fa fa-star" id="star5-Detective-Pikachu-Returns" onclick="rate('5', 'Detective Pikachu Returns')"></span>
              <span class="rating-number" id="numRatings-Detective-Pikachu-Returns">(0)</span>
            </div>      
          </div>

        </div>
      </div>

      <!-- Game #2 -->
      <div class="slideshow-container">
        <div id="carousel-switch-2" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-switch-2"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-2"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-2"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/RPiT-s4i0rw"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="images/pikmin-4-announcement-art.webp"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://media.cnn.com/api/v1/images/stellar/prod/pikmin-lead.jpg?c=16x9&q=h_720,w_1280,c_fill/f_webp"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-switch-2"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-switch-2"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Pikmin 4</h3>
          <p class="summary">
            Pikmin is one of those bizarre games that are exclusive to Nintendo
            consoles, and have always been a cult classic, but never garnered
            enough attention to break it into the mainstream. The addition of
            the original game's protagonist, Captain Olimar, to the Super Smash
            Bros. franchise brought more attention to Pikmin, and eventually
            demand for a new Pikmin grew. Now, it looks like Pikmin is ready to
            become a mainstream title, which will bring Pikmin 4 to the Nintendo
            Switch in 2023.
          </p>
          <a href="https://www.nintendo.com/" class="gameLink" target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.nintendo.com/store/products/pikmin-4-switch/"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Pikmin-4">
              <span class="fa fa-star" id="star1-Pikmin-4" onclick="rate('1', 'Pikmin 4')"></span>
              <span class="fa fa-star" id="star2-Pikmin-4" onclick="rate('2', 'Pikmin 4')"></span>
              <span class="fa fa-star" id="star3-Pikmin-4" onclick="rate('3', 'Pikmin 4')"></span>
              <span class="fa fa-star" id="star4-Pikmin-4" onclick="rate('4', 'Pikmin 4')"></span>
              <span class="fa fa-star" id="star5-Pikmin-4" onclick="rate('5', 'Pikmin 4')"></span>
              <span class="rating-number" id="numRatings-Pikmin-4">(0)</span>
            </div>      
          </div>

        </div>
      </div>

      <!-- Game #3 -->
      <div class="slideshow-container">
        <div id="carousel-switch-3" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-switch-3"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-3"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-switch-3"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/JStAYvbeSHc"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://assets.nintendo.com/image/upload/f_auto/q_auto/dpr_2.0/c_scale,w_800/ncom/en_US/articles/2023/super-mario-bros-wonder-jump-into-the-next-evolution-of-mario-side-scrolling-fun/2250x1266_WN_SMW"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://m.media-amazon.com/images/I/71dJVeTWvPL._SL1500_.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-switch-3"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-switch-3"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Super Mario Bros. Wonder</h3>
          <p class="summary">
            Super Mario Bros. Wonder] is an upcoming platform game developed and
            published by Nintendo for the Nintendo Switch. It is the first
            traditional side-scrolling Super Mario game since New Super Mario
            Bros. U (2012) and is scheduled to be released on October 20, 2023.
          </p>
          <a href="https://www.nintendo.com/" class="gameLink" target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.nintendo.com/store/products/super-mario-bros-wonder-switch/"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Super-Mario-Bros-Wonder">
              <span class="fa fa-star" id="star1-Super-Mario-Bros-Wonder" onclick="rate('1', 'Super Mario Bros. Wonder')"></span>
              <span class="fa fa-star" id="star2-Super-Mario-Bros-Wonder" onclick="rate('2', 'Super Mario Bros. Wonder')"></span>
              <span class="fa fa-star" id="star3-Super-Mario-Bros-Wonder" onclick="rate('3', 'Super Mario Bros. Wonder')"></span>
              <span class="fa fa-star" id="star4-Super-Mario-Bros-Wonder" onclick="rate('4', 'Super Mario Bros. Wonder')"></span>
              <span class="fa fa-star" id="star5-Super-Mario-Bros-Wonder" onclick="rate('5', 'Super Mario Bros. Wonder')"></span>
              <span class="rating-number" id="numRatings-Super-Mario-Bros-Wonder">(0)</span>
            </div>      
          </div>          

        </div>
      </div>

      <!-- About us section -->
      <div class="purpose">
        <h2>About Us</h2>
        <p>Made by: Erkin Abdullaev, Tafhim Khan, Bodrye Kamdem</p>
      </div>
    </div>

    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>

    <!-- rating backend-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { getFirestore, doc, collection, addDoc, getDoc, query, where, runTransaction } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";
      
      // Firebase configuration details
      const firebaseConfig = {
        apiKey: "AIzaSyDpNUEId6oedAblTKRQh9ZHj76D1IIzlyY",
        authDomain: "gaming-showcase.firebaseapp.com",
        projectId: "gaming-showcase",
        storageBucket: "gaming-showcase.appspot.com",
        messagingSenderId: "918009808163",
        appId: "1:918009808163:web:3bc3ffb886b1114a93b896",
        measurementId: "G-6V83DP6L23"
      };
    
      // initialize Firebase and check if any Firebase apps have been initialized yet
      let app;
      if (!getApps().length) { 
        app = initializeApp(firebaseConfig);
      }
      const analytics = getAnalytics(app);
      const db = getFirestore(app);
      
      // Remove spaces from the game title to use in HTML element IDs
      function toHtmlId(gameTitle) {
          return gameTitle.replace(/\W+/g, "-");
      }
      // handles game rating
      function rate(starNumber, gameTitle) {
        let i;
        let gameTitleId = toHtmlId(gameTitle);
        
        
        // First, clear all stars
        for (i = 5; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star';
        }

        // Then, highlight the number of stars the user selected
        for (i = starNumber; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star checked';
        }

        // finally, update the rating in the Firestore database
        updateRating(gameTitle, starNumber).catch(console.error);
      }

      // Updates rating to server when user clicks
      async function updateRating(gameTitle, rating) {
        const gameTitleId = toHtmlId(gameTitle);
        const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);

        // Temporarily updates the number of ratings displayed on the page, before making the change to Firestore
        const currentCount = Number(numRatingsElement.textContent.replace(/[()]/g, ""));
        numRatingsElement.textContent = `(${currentCount + 1})`; // Temporarily increment the counter

        const ratingRef = doc(db, "ratings", gameTitle);
        try {
          const newCount = await runTransaction(db, async (transaction) => {
            const ratingDoc = await transaction.get(ratingRef);
            if (!ratingDoc.exists()) {
              await setDoc(ratingRef, { totalRating: Number(rating), count: 1 });
              return 1;
            } else {
              const newTotalRating = ratingDoc.data().totalRating + Number(rating);
              const newCount = ratingDoc.data().count + 1;
              transaction.update(ratingRef, { totalRating: newTotalRating, count: newCount });
              return newCount;
            }
          });
          numRatingsElement.textContent = `(${newCount})`; // Update the counter to the actual new count
        } catch (error) {
          console.error('Failed to update rating:', error);
          numRatingsElement.textContent = `(${currentCount})`; // Revert to the original count if there was an error
        }
      }

      async function fetchRating(gameTitle) {
        const ratingRef = doc(db, "ratings", gameTitle);
        const ratingSnap = await getDoc(ratingRef);
        if (ratingSnap.exists()) {
          const gameTitleId = toHtmlId(gameTitle);
          const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);
          if (numRatingsElement) {
              numRatingsElement.textContent = `(${ratingSnap.data().count})`;
          }
          return Math.round(ratingSnap.data().totalRating / ratingSnap.data().count);
        }
        return 0;
      }

      async function setRatingStars(gameTitle) {
        let gameTitleId = toHtmlId(gameTitle);
        let rating = await fetchRating(gameTitle).catch(console.error);
        let i;
        for (i = rating; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          if (starElement) {
            starElement.className = 'fa fa-star checked';
          }
        }
      }

      window.rate = rate;
      window.onload = function() {
        setRatingStars("Detective Pikachu Returns");
        setRatingStars("Pikmin 4");
        setRatingStars("Super Mario Bros. Wonder");
      };
    </script>

  </body>
</html>
