<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Showcase 2023</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/showcaseStyle.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body style="background-color: #ff8c00">
    <div class="front-page">
      <!-- Title Start! -->
      <h1 class="title">Gaming Showcase 2023</h1>
      <h2 class="logo"><img src="gameController.png" alt="Logo" /></h2>

      <!-- NAV BAR START -->
      <div class="topnav" id="myTopnav">
        <div class="myLinks">
          <!-- Add your navigation links here -->
          <a href="index.html" id="homeButton">Home</a>
          <a href="showcase.html" class="active">Gaming Showcase</a>
          <a href="pcExclusive.html">PC Exclusive</a>
          <a href="ps5exclusive.html">PS5 Exclusive</a>
          <a href="xbox.html">Xbox Exclusive</a>
          <a href="switch.html">Switch Exclusive</a>

          <!-- Search bar section -->
          <a class="search-container">
            <input type="text" id="searchInput" placeholder="Search Games..." />
          </a>

          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
      </div>

      <!-- Purpose of Website START -->
      <div class="purpose">
        <h2>Showcase</h2>
        <p>Here you will find games coming in 2023</p>
      </div>

      <!-- Game Slideshow/Carosel Here -->
      <!-- Game #1 -->
      <div class="slideshow-container">
        <div id="carousel-GS-1" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-GS-1"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-1"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-1"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/PAYLi7Ao6Kg"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://esports.gg/_next/image/?url=https%3A%2F%2Fadmin.esports.gg%2Fwp-content%2Fuploads%2F2023%2F05%2Fimage-45-4-1024x576.jpg&w=3840&q=75"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://cdn.vox-cdn.com/thumbor/ylYkNEvm2HQjbM3Y6R79sr6vfo0=/0x0:1920x1080/1200x800/filters:focal(810x243:1116x549)/cdn.vox-cdn.com/uploads/chorus_image/image/72473572/Mortal_Kombat_1___Official_Kombat_Pack_Roster_Reveal_Trailer_Thumbnail.6.jpeg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-GS-1"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-GS-1"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Mortal Kombat 1</h3>
          <p class="summary">
            Mortal Kombat 1 is an upcoming fighting game that aims to be the
            twelfth main installment in the Mortal Kombat series and a sequel to
            Mortal Kombat 11 (2019). The game will introduce a reborn Mortal
            Kombat Universe that has been created by the Fire God Liu Kang,
            featuring reimagined versions of iconic characters, along with a new
            fighting system, game modes, bone crushing finishing moves, and
            more.
          </p>
          <a
            href="https://www.netherrealm.com/"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.mortalkombat.com/en-us/purchase"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Mortal-Kombat-1">
              <span class="fa fa-star" id="star1-Mortal-Kombat-1" onclick="rate('1', 'Mortal Kombat 1')"></span>
              <span class="fa fa-star" id="star2-Mortal-Kombat-1" onclick="rate('2', 'Mortal Kombat 1')"></span>
              <span class="fa fa-star" id="star3-Mortal-Kombat-1" onclick="rate('3', 'Mortal Kombat 1')"></span>
              <span class="fa fa-star" id="star4-Mortal-Kombat-1" onclick="rate('4', 'Mortal Kombat 1')"></span>
              <span class="fa fa-star" id="star5-Mortal-Kombat-1" onclick="rate('5', 'Mortal Kombat 1')"></span>
              <span class="rating-number" id="numRatings-Mortal-Kombat-1">(0)</span>
            </div>      
          </div>

        </div>
      </div>

      <!-- Game #2 -->
      <div class="slideshow-container">
        <div id="carousel-GS-2" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-GS-2"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-2"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-2"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/Z5aBbuInWvs"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://assets.nintendo.com/image/upload/c_fill,w_1200/q_auto:best/f_auto/dpr_2.0/ncom/software/switch/70010000066005/82111f4c361948a56afa01658171015ef2ce31dd4bbf6963f7854f19254f6d0f"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://rpgamer.com/wp-content/uploads/2023/06/persona-5-tactica_2023-06-11_022-scaled.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-GS-2"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-GS-2"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Persona 5 Tactica</h3>
          <p class="summary">
            Persona 5 Tactica is an upcoming tactical RPG that acts as a
            spin-off from the Persona series, itself a part of the larger Megami
            Tensei franchise. It follows the Phantom Thieves of Hearts in an
            alternate world of war, oppression, and their alliance with the
            Rebel Corps. Gameplay includes familiar strategy RPG elements along
            with unique mechanics like Persona summoning, fusion, and elemental
            affinities.
          </p>
          <a
            href="https://www.giantbomb.com/p-studio/3010-9396/"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.nintendo.com/store/products/persona-5-tactica-switch/"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Persona-5-Tactica">
              <span class="fa fa-star" id="star1-Persona-5-Tactica" onclick="rate('1', 'Persona 5 Tactica')"></span>
              <span class="fa fa-star" id="star2-Persona-5-Tactica" onclick="rate('2', 'Persona 5 Tactica')"></span>
              <span class="fa fa-star" id="star3-Persona-5-Tactica" onclick="rate('3', 'Persona 5 Tactica')"></span>
              <span class="fa fa-star" id="star4-Persona-5-Tactica" onclick="rate('4', 'Persona 5 Tactica')"></span>
              <span class="fa fa-star" id="star5-Persona-5-Tactica" onclick="rate('5', 'Persona 5 Tactica')"></span>
              <span class="rating-number" id="numRatings-Persona-5-Tactica">(0)</span>
            </div>      
          </div>
          
        </div>
      </div>

      <!-- Game #3 -->
      <div class="slideshow-container">
        <div id="carousel-GS-3" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-GS-3"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-3"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-GS-3"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/ISCbJ9RlDgU"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://cdn.cloudflare.steamstatic.com/steam/apps/1433140/capsule_616x353.jpg?t=1685419183"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://assets1.ignimgs.com/thumbs/userUploaded/2022/6/13/texaschainsawmassacreuncutgameplaytrailerignblogroll-1655166855255.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-GS-3"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-GS-3"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">The Texas Chain Saw Massacre</h3>
          <p class="summary">
            "The Texas Chain Saw Massacre" game invites you to experience the
            delightful feel of rural Texas. Embrace your inner lumberjack as you
            engage in unconventional butchering activities, all while solving
            the mystery of missing tourists. Prepare for a "cutting-edge"
            adventure that's sure to leave you in stitches. Just keep your
            chainsaw fueled and you should be fine.
          </p>
          <a
            href="https://www.square-enix-games.com/en_US/home"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.playstation.com/en-us/games/final-fantasy-xvi/"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-The-Texas-Chain-Saw-Massacre">
              <span class="fa fa-star" id="star1-The-Texas-Chain-Saw-Massacre" onclick="rate('1', 'The Texas Chain Saw Massacre')"></span>
              <span class="fa fa-star" id="star2-The-Texas-Chain-Saw-Massacre" onclick="rate('2', 'The Texas Chain Saw Massacre')"></span>
              <span class="fa fa-star" id="star3-The-Texas-Chain-Saw-Massacre" onclick="rate('3', 'The Texas Chain Saw Massacre')"></span>
              <span class="fa fa-star" id="star4-The-Texas-Chain-Saw-Massacre" onclick="rate('4', 'The Texas Chain Saw Massacre')"></span>
              <span class="fa fa-star" id="star5-The-Texas-Chain-Saw-Massacre" onclick="rate('5', 'The Texas Chain Saw Massacre')"></span>
              <span class="rating-number" id="numRatings-The-Texas-Chain-Saw-Massacre">(0)</span>
            </div>      
          </div>
          
        </div>
      </div>

      <!-- About us section -->
      <div class="purpose">
        <h2>About Us</h2>
        <p>Made by: Erkin Abdullaev, Tafhim Khan, Bodrye Kamdem</p>
      </div>
    </div>

    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>
    
    <!-- rating backend-->
    <script type="module">
      // Import the required Firebase SDK modules
      import { getFirestore, doc, collection, addDoc, getDoc, query, where, runTransaction } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { initializeApp, getApps } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";

      // Firebase configuration details
      const firebaseConfig = {
        apiKey: "AIzaSyDpNUEId6oedAblTKRQh9ZHj76D1IIzlyY",
        authDomain: "gaming-showcase.firebaseapp.com",
        projectId: "gaming-showcase",
        storageBucket: "gaming-showcase.appspot.com",
        messagingSenderId: "918009808163",
        appId: "1:918009808163:web:3bc3ffb886b1114a93b896",
        measurementId: "G-6V83DP6L23"
      };

      // initialize Firebase and check if any Firebase apps have been initialized yet
      let app;
      if (!getApps().length) {
        // If not, initialize a new Firebase app using the given configuration
        app = initializeApp(firebaseConfig);
      }
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // handles game rating
      function rate(starNumber, gameTitle) {
        let gameTitleId = gameTitle.split(" ").join("-");

        // First, clear all stars
        for (let i = 5; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star';
        }

        // Then, highlight the number of stars the user selected
        for (let i = starNumber; i > 0; i--) {
          let starElement = document.getElementById('star' + i + '-' + gameTitleId);
          starElement.className = 'fa fa-star checked';
        }

        // finally, update the rating in the Firestore database
        updateRating(gameTitle, starNumber).catch(console.error);
      }

      // Updates rating to server when user clicks
      async function updateRating(gameTitle, rating) {
        // Prepare references to HTML and Firestore elements
        const gameTitleId = gameTitle.split(" ").join("-");
        const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);
        const ratingRef = doc(db, "ratings", gameTitle);

        // Temporarily updates the number of ratings displayed on the page, before making the change to Firestore
        const currentCount = Number(numRatingsElement.textContent.replace(/[()]/g, ""));
        numRatingsElement.textContent = `(${currentCount + 1})`;

        try {
          const newCount = await runTransaction(db, async (transaction) => {
            const ratingDoc = await transaction.get(ratingRef);
            // If the document doesn't exist, create it and set the count to 1
            if (!ratingDoc.exists()) {
              await setDoc(ratingRef, { totalRating: Number(rating), count: 1 });
              return 1;
            } else {
              // Otherwise, increment the total rating and the count
              const newTotalRating = ratingDoc.data().totalRating + Number(rating);
              const newCount = ratingDoc.data().count + 1;
              transaction.update(ratingRef, { totalRating: newTotalRating, count: newCount });
              return newCount;
            }
          });

          // Update the displayed count with the actual new count
          numRatingsElement.textContent = `(${newCount})`;

        } catch (error) {
          console.error('Failed to update rating:', error);
          // If there was an error, revert the displayed count back to the original
          numRatingsElement.textContent = `(${currentCount})`;
        }
      }

      // Fetch the current rating for a game from the Firestore database
      async function fetchRating(gameTitle) {
        const ratingRef = doc(db, "ratings", gameTitle);
        const ratingSnap = await getDoc(ratingRef);

        if (ratingSnap.exists()) {
          const gameTitleId = gameTitle.split(" ").join("-");
          const numRatingsElement = document.getElementById('numRatings-' + gameTitleId);
          if (numRatingsElement) {
            numRatingsElement.textContent = `(${ratingSnap.data().count})`;
          }

          // Calculate the average rating and return it
          return Math.round(ratingSnap.data().totalRating / ratingSnap.data().count);
        }

        // If the document doesn't exist, return 0
        return 0;
      }

      // Display the current rating for a game on the page
      async function setRatingStars(gameTitle) {
        const gameTitleId = gameTitle.split(" ").join("-");
        const rating = await fetchRating(gameTitle).catch(console.error);

        // Highlight the average number of stars
        for (let i = rating; i > 0; i--) {
          const starElement = document.getElementById('star' + i + '-' + gameTitleId);
          if (starElement) {
            starElement.className = 'fa fa-star checked';
          }
        }
      }

      // Expose the `rate` function to the global scope so it can be called from HTML onclick attributes
      window.rate = rate;

      // When the window loads, display the current ratings for the games
      window.onload = function() {
        setRatingStars("Mortal Kombat 1");
        setRatingStars("Persona 5 Tactica");
        setRatingStars("The Texas Chain Saw Massacre");
      };
    </script>

  </body>
</html>
