<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Showcase 2023</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/ps4style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body style="background-color: #003791">
    <div class="front-page">
      <!-- Title Start! -->
      <h1 class="title">Gaming Showcase 2023</h1>
      <h2 class="logo"><img src="gameController.png" alt="Logo" /></h2>

      <!-- NAV BAR START -->
      <div class="topnav" id="myTopnav">
        <div class="myLinks">
          <!-- Add your navigation links here -->
          <a href="index.html" id="homeButton">Home</a>
          <a href="showcase.html">Gaming Showcase</a>
          <a href="pcExclusive.html">PC Exclusive</a>
          <a href="ps5exclusive.html" class="active">PS5 Exclusive</a>
          <a href="xbox.html">Xbox Exclusive</a>
          <a href="switch.html">Switch Exclusive</a>

          <!-- Search bar section -->
          <a class="search-container">
            <input type="text" id="searchInput" placeholder="Search Games..." />
          </a>

          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
      </div>

      <!-- Purpose of Website START -->
      <div class="purpose">
        <h2>PS5 Exclusive</h2>
        <p>
          Here you will find all the PS5 games that are exclusively coming in
          2023
        </p>
      </div>

      <!-- Game Slideshow/Carosel Here -->
      <!-- Game #1 -->
      <div class="slideshow-container">
        <div id="carousel-PS5-1" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PS5-1"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-1"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-1"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/qIQ3xNqkVC4"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://www.escapistmagazine.com/wp-content/uploads/2023/05/Marvels-Spider-Man-2-gameplay.jpg?fit=1239%2C693"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://assets-prd.ignimgs.com/2023/05/25/spider-man-2-tentacles-1685015679907.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PS5-1"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PS5-1"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Spider-Man 2</h3>
          <p class="summary">
            Marvel's Spider-Man 2 is an upcoming action-adventure game developed
            by Insomniac Games and published by Sony Interactive Entertainment.
            Based on the Marvel Comics character Spider-Man, it features a
            narrative inspired by the long-running comic book mythology while
            also deriving from various adaptations in other media.
          </p>
          <a
            href="https://www.playstation.com/en-us/"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.playstation.com/en-us/games/marvels-spider-man-2/"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Spider-Man-2">
              <span
                class="fa fa-star"
                id="star1-Spider-Man-2"
                onclick="rate('1', 'Spider-Man 2')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Spider-Man-2"
                onclick="rate('2', 'Spider-Man 2')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Spider-Man-2"
                onclick="rate('3', 'Spider-Man 2')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Spider-Man-2"
                onclick="rate('4', 'Spider-Man 2')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Spider-Man-2"
                onclick="rate('5', 'Spider-Man 2')"
              ></span>
              <span class="rating-number" id="numRatings-Spider-Man-2"
                >(0)</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Game #2 -->
      <div class="slideshow-container">
        <div id="carousel-PS5-2" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PS5-2"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-2"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-2"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/iNX8QCeymFM"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://www.theloadout.com/wp-content/sites/theloadout/2023/05/Metal-Gear-Solid-Snake-Eater-Release-Date.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://assets-prd.ignimgs.com/2023/05/24/playstation-showcase-2023-english-1-13-41-screenshot-1684961020279.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PS5-2"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PS5-2"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Metal Gear Solid Delta: Snake Eater</h3>
          <p class="summary">
            Metal Gear Solid Delta: Snake Eater is an upcoming action-adventure
            stealth video game developed and published by Konami. It is a remake
            of the 2004 game Metal Gear Solid 3: Snake Eater. As with the
            original game, the narrative is set in 1964...
          </p>
          <a href="https://www.konami.com/en/" class="gameLink" target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.playstation.com/en-us/games/metal-gear-solid-delta-snake-eater/"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div
              class="rating-system"
              id="rating-system-Metal-Gear-Solid-Delta-Snake-Eater"
            >
              <span
                class="fa fa-star"
                id="star1-Metal-Gear-Solid-Delta-Snake-Eater"
                onclick="rate('1', 'Metal Gear Solid Delta: Snake Eater')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Metal-Gear-Solid-Delta-Snake-Eater"
                onclick="rate('2', 'Metal Gear Solid Delta: Snake Eater')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Metal-Gear-Solid-Delta-Snake-Eater"
                onclick="rate('3', 'Metal Gear Solid Delta: Snake Eater')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Metal-Gear-Solid-Delta-Snake-Eater"
                onclick="rate('4', 'Metal Gear Solid Delta: Snake Eater')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Metal-Gear-Solid-Delta-Snake-Eater"
                onclick="rate('5', 'Metal Gear Solid Delta: Snake Eater')"
              ></span>
              <span
                class="rating-number"
                id="numRatings-Metal-Gear-Solid-Delta-Snake-Eater"
                >(0)</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Game #3 -->
      <div class="slideshow-container">
        <div id="carousel-PS5-3" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-PS5-3"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-3"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-PS5-3"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/aPT26Dd3OzE"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://images.pushsquare.com/b3cab96140818/final-fantasy-16-series-rating.large.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://cdn11.bigcommerce.com/s-6rs11v9w2d/images/stencil/original/image-manager/faith-estorebanners-1600x900.jpg?t=1683647892"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-PS5-3"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-PS5-3"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Final Fantasy XVI</h3>
          <p class="summary">
            Final Fantasy XVI is a 2023 action role-playing game developed and
            published by Square Enix. The sixteenth main installment in the
            Final Fantasy series, it was released for the PlayStation 5 as a
            timed exclusive. The game features segmented open environments and
            an action-based combat system involving melee and magic-based
            attacks.
          </p>
          <a
            href="https://www.square-enix-games.com/en_US/home"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.playstation.com/en-us/games/final-fantasy-xvi/"
            class="gameLink"
            target="_blank"
            >Buy Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Final-Fantasy-XVI">
              <span
                class="fa fa-star"
                id="star1-Final-Fantasy-XVI"
                onclick="rate('1', 'Final Fantasy XVI')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Final-Fantasy-XVI"
                onclick="rate('2', 'Final Fantasy XVI')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Final-Fantasy-XVI"
                onclick="rate('3', 'Final Fantasy XVI')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Final-Fantasy-XVI"
                onclick="rate('4', 'Final Fantasy XVI')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Final-Fantasy-XVI"
                onclick="rate('5', 'Final Fantasy XVI')"
              ></span>
              <span class="rating-number" id="numRatings-Final-Fantasy-XVI"
                >(0)</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- About us section -->
      <div class="purpose">
        <h2>About Us</h2>
        <p>Made by: Erkin Abdullaev, Tafhim Khan, Bodrye Kamdem, Khanh Huang</p>
      </div>
    </div>

    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>

    <!-- rating backend-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import {
        getFirestore,
        doc,
        collection,
        addDoc,
        getDoc,
        query,
        where,
        runTransaction,
      } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import {
        initializeApp,
        getApps,
      } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";

      // Firebase configuration details
      const firebaseConfig = {
        apiKey: "AIzaSyDpNUEId6oedAblTKRQh9ZHj76D1IIzlyY",
        authDomain: "gaming-showcase.firebaseapp.com",
        projectId: "gaming-showcase",
        storageBucket: "gaming-showcase.appspot.com",
        messagingSenderId: "918009808163",
        appId: "1:918009808163:web:3bc3ffb886b1114a93b896",
        measurementId: "G-6V83DP6L23",
      };

      // initialize Firebase and check if any Firebase apps have been initialized yet
      let app;
      if (!getApps().length) {
        app = initializeApp(firebaseConfig);
      }
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // Remove spaces from the game title to use in HTML element IDs
      function toHtmlId(gameTitle) {
        return gameTitle.replace(/\W+/g, "-");
      }
      // handles game rating
      function rate(starNumber, gameTitle) {
        let i;
        let gameTitleId = toHtmlId(gameTitle);

        // First, clear all stars
        for (i = 5; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          starElement.className = "fa fa-star";
        }

        // Then, highlight the number of stars the user selected
        for (i = starNumber; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          starElement.className = "fa fa-star checked";
        }

        // finally, update the rating in the Firestore database
        updateRating(gameTitle, starNumber).catch(console.error);
      }

      // Updates rating to server when user clicks
      async function updateRating(gameTitle, rating) {
        const gameTitleId = toHtmlId(gameTitle);
        const numRatingsElement = document.getElementById(
          "numRatings-" + gameTitleId
        );

        // Temporarily updates the number of ratings displayed on the page, before making the change to Firestore
        const currentCount = Number(
          numRatingsElement.textContent.replace(/[()]/g, "")
        );
        numRatingsElement.textContent = `(${currentCount + 1})`; // Temporarily increment the counter

        const ratingRef = doc(db, "ratings", gameTitle);
        try {
          const newCount = await runTransaction(db, async (transaction) => {
            const ratingDoc = await transaction.get(ratingRef);
            if (!ratingDoc.exists()) {
              await setDoc(ratingRef, {
                totalRating: Number(rating),
                count: 1,
              });
              return 1;
            } else {
              const newTotalRating =
                ratingDoc.data().totalRating + Number(rating);
              const newCount = ratingDoc.data().count + 1;
              transaction.update(ratingRef, {
                totalRating: newTotalRating,
                count: newCount,
              });
              return newCount;
            }
          });
          numRatingsElement.textContent = `(${newCount})`; // Update the counter to the actual new count
        } catch (error) {
          console.error("Failed to update rating:", error);
          numRatingsElement.textContent = `(${currentCount})`; // Revert to the original count if there was an error
        }
      }

      async function fetchRating(gameTitle) {
        const ratingRef = doc(db, "ratings", gameTitle);
        const ratingSnap = await getDoc(ratingRef);
        if (ratingSnap.exists()) {
          const gameTitleId = toHtmlId(gameTitle);
          const numRatingsElement = document.getElementById(
            "numRatings-" + gameTitleId
          );
          if (numRatingsElement) {
            numRatingsElement.textContent = `(${ratingSnap.data().count})`;
          }
          return Math.round(
            ratingSnap.data().totalRating / ratingSnap.data().count
          );
        }
        return 0;
      }

      async function setRatingStars(gameTitle) {
        let gameTitleId = toHtmlId(gameTitle);

        let rating = await fetchRating(gameTitle).catch(console.error);
        let i;
        for (i = rating; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          if (starElement) {
            starElement.className = "fa fa-star checked";
          }
        }
      }

      window.rate = rate;
      window.onload = function () {
        setRatingStars("Spider-Man 2");
        setRatingStars("Metal Gear Solid Delta: Snake Eater");
        setRatingStars("Final Fantasy XVI");
      };
    </script>
  </body>
</html>
