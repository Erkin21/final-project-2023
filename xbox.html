<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gaming Showcase 2023</title>
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/xbox.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"
      crossorigin="anonymous"
    />
  </head>
  <body style="background-color: #107c10">
    <div class="front-page">
      <!-- Title Start -->
      <h1 class="title">Gaming Showcase 2023</h1>
      <h2 class="logo"><img src="gameController.png" alt="Logo" /></h2>

      <!-- NAV BAR START -->
      <div class="topnav" id="myTopnav">
        <div class="myLinks">
          <!-- Add your navigation links here -->
          <a href="index.html" id="homeButton">Home</a>
          <a href="showcase.html">Gaming Showcase</a>
          <a href="pcExclusive.html">PC Exclusive</a>
          <a href="ps5exclusive.html">PS5 Exclusive</a>
          <a href="xbox.html" class="active">Xbox Exclusive</a>
          <a href="switch.html">Switch Exclusive</a>

          <!-- Search bar section -->
          <a class="search-container">
            <input type="text" id="searchInput" placeholder="Search Games..." />
          </a>

          <a href="javascript:void(0);" class="icon" onclick="myFunction()">
            <i class="fa fa-bars"></i>
          </a>
        </div>
      </div>

      <!-- Purpose of Website START -->
      <div class="purpose">
        <h2>Xbox Exclusive</h2>
        <p>
          Here you will find all the Xbox games that are exclusively coming in
          2023
        </p>
      </div>

      <!-- Game Slideshow/Carosel Here -->
      <!-- Game #1 -->
      <div class="slideshow-container">
        <div id="carousel-xbox-1" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-xbox-1"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-1"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-1"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/W3QkO8fy3tg"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="images/WCCFavowed1-HD-scaled.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img src="images/resize.webp" class="d-block w-100" alt="..." />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-xbox-1"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-xbox-1"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Avowed</h3>
          <p class="summary">
            Avowed is a first-person fantasy RPG video game that is being
            developed by Obsidian Entertainment.
          </p>
          <a
            href="https://avowed.obsidian.net/"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.xbox.com/en-US/games/store/avowed/9nhrdqvfpq34"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Avowed">
              <span
                class="fa fa-star"
                id="star1-Avowed"
                onclick="rate('1', 'Avowed')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Avowed"
                onclick="rate('2', 'Avowed')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Avowed"
                onclick="rate('3', 'Avowed')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Avowed"
                onclick="rate('4', 'Avowed')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Avowed"
                onclick="rate('5', 'Avowed')"
              ></span>
              <span class="rating-number" id="numRatings-Avowed">(0)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Game #2 -->
      <div class="slideshow-container">
        <div id="carousel-xbox-2" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-xbox-2"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-2"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-2"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/kfYEiTdsyas"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="images/Starfield-Planets.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="images/starfield.webp"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-xbox-2"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-xbox-2"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Starfield</h3>
          <p class="summary">
            Starfield is an action role-playing video game. Players can switch
            between a first-person and third-person perspective any time in the
            game. Starfield features an open world in the form of an area within
            the Milky Way galaxy, containing both fictional and non-fictional
            planetary systems, with players being able to land on more than
            1,000 planets and an unspecified number of moons and space stations.
          </p>
          <a
            href="https://bethesda.net/en/dashboard"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://bethesda.net/en/game/starfield"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Starfield">
              <span
                class="fa fa-star"
                id="star1-Starfield"
                onclick="rate('1', 'Starfield')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Starfield"
                onclick="rate('2', 'Starfield')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Starfield"
                onclick="rate('3', 'Starfield')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Starfield"
                onclick="rate('4', 'Starfield')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Starfield"
                onclick="rate('5', 'Starfield')"
              ></span>
              <span class="rating-number" id="numRatings-Starfield">(0)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Game #3 -->
      <div class="slideshow-container">
        <div id="carousel-xbox-3" class="shape carousel slide carousel-left">
          <div class="carousel-indicators">
            <!-- Add your carousel indicators here -->
            <button
              type="button"
              data-bs-target="#carousel-xbox-3"
              data-bs-slide-to="0"
              class="active"
              aria-current="true"
              aria-label="Slide 1"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-3"
              data-bs-slide-to="1"
              aria-label="Slide 2"
            ></button>
            <button
              type="button"
              data-bs-target="#carousel-xbox-3"
              data-bs-slide-to="2"
              aria-label="Slide 3"
            ></button>
          </div>
          <div class="carousel-inner">
            <!-- Add your carousel items here -->
            <div class="carousel-item active">
              <div class="embed-responsive embed-responsive-16by9">
                <iframe
                  src="https://www.youtube.com/embed/DDFuhaYxeMU"
                  class="embed-responsive-item"
                ></iframe>
              </div>
            </div>
            <div class="carousel-item">
              <img
                src="https://www.dexerto.com/cdn-cgi/image/width=3840,quality=75,format=auto/https://editors.dexerto.com/wp-content/uploads/2023/06/12/clockwork-revolution.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
            <div class="carousel-item">
              <img
                src="https://d1lss44hh2trtw.cloudfront.net/assets/article/2023/06/11/clockwork-revolution-inxile-entertainment_feature.jpg"
                class="d-block w-100"
                alt="..."
              />
            </div>
          </div>
          <button
            class="carousel-control-prev radius"
            type="button"
            data-bs-target="#carousel-xbox-3"
            data-bs-slide="prev"
          >
            <span class="carousel-control-prev-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button
            class="carousel-control-next radius"
            type="button"
            data-bs-target="#carousel-xbox-3"
            data-bs-slide="next"
          >
            <span class="carousel-control-next-icon" aria-hidden="false"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>

        <div class="slideshow-text">
          <h3 class="gameTitle">Clockwork Revolution</h3>
          <p class="summary">
            After stumbling across an incredible invention that allows you to
            travel into the past, you discover the city you call home—the
            vibrant steam-powered metropolis of Avalon—has been carefully
            crafted through the alteration of key historical events. By
            traveling back in time, your interactions and choices in the past
            will have a butterfly effect on the deep, narrative-driven world and
            characters of Avalon, causing them to change and react in
            unprecedented ways.
          </p>
          <a
            href="https://inxile.net/games/clockwork-revolution"
            class="gameLink"
            target="_blank"
            >Author's Website</a
          >
          <a
            href="https://www.xbox.com/en-us/games/store/clockwork-revolution/9p2rb6xcs4d4"
            class="gameLink"
            target="_blank"
            >Pre-Order Now</a
          >
          <div class="gameLink rating-container">
            <!--Stars Implementation -->
            <div class="rating-system" id="rating-system-Clockwork-Revolution">
              <span
                class="fa fa-star"
                id="star1-Clockwork-Revolution"
                onclick="rate('1', 'Clockwork Revolution')"
              ></span>
              <span
                class="fa fa-star"
                id="star2-Clockwork-Revolution"
                onclick="rate('2', 'Clockwork Revolution')"
              ></span>
              <span
                class="fa fa-star"
                id="star3-Clockwork-Revolution"
                onclick="rate('3', 'Clockwork Revolution')"
              ></span>
              <span
                class="fa fa-star"
                id="star4-Clockwork-Revolution"
                onclick="rate('4', 'Clockwork Revolution')"
              ></span>
              <span
                class="fa fa-star"
                id="star5-Clockwork-Revolution"
                onclick="rate('5', 'Clockwork Revolution')"
              ></span>
              <span class="rating-number" id="numRatings-Clockwork-Revolution"
                >(0)</span
              >
            </div>
          </div>
        </div>
      </div>

      <!-- About us section -->
      <div class="purpose">
        <h2>About Us</h2>
        <p>Made by: Erkin Abdullaev, Tafhim Khan, Bodrye Kamdem, Khanh Huang</p>
      </div>
    </div>

    <script src="js/script.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"
      integrity="sha384-fbbOQedDUMZZ5KreZpsbe1LCZPVmfTnH7ois6mU1QK+m14rQ1l2bGBq41eYeM/fS"
      crossorigin="anonymous"
    ></script>

    <!-- rating backend-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import {
        getFirestore,
        doc,
        collection,
        addDoc,
        getDoc,
        query,
        where,
        runTransaction,
      } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import { setDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
      import {
        initializeApp,
        getApps,
      } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-analytics.js";

      // Firebase configuration details
      const firebaseConfig = {
        apiKey: "AIzaSyDpNUEId6oedAblTKRQh9ZHj76D1IIzlyY",
        authDomain: "gaming-showcase.firebaseapp.com",
        projectId: "gaming-showcase",
        storageBucket: "gaming-showcase.appspot.com",
        messagingSenderId: "918009808163",
        appId: "1:918009808163:web:3bc3ffb886b1114a93b896",
        measurementId: "G-6V83DP6L23",
      };

      // initialize Firebase and check if any Firebase apps have been initialized yet
      let app;
      if (!getApps().length) {
        app = initializeApp(firebaseConfig);
      }
      const analytics = getAnalytics(app);
      const db = getFirestore(app);

      // handles game rating
      function rate(starNumber, gameTitle) {
        let i;
        let gameTitleId = gameTitle.split(" ").join("-");

        // First, clear all stars
        for (i = 5; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          starElement.className = "fa fa-star";
        }

        // Then, highlight the number of stars the user selected
        for (i = starNumber; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          starElement.className = "fa fa-star checked";
        }

        // finally, update the rating in the Firestore database
        updateRating(gameTitle, starNumber).catch(console.error);
      }

      // Updates rating to server when user clicks
      async function updateRating(gameTitle, rating) {
        const gameTitleId = gameTitle.split(" ").join("-");
        const numRatingsElement = document.getElementById(
          "numRatings-" + gameTitleId
        );

        // Temporarily updates the number of ratings displayed on the page, before making the change to Firestore
        const currentCount = Number(
          numRatingsElement.textContent.replace(/[()]/g, "")
        );
        numRatingsElement.textContent = `(${currentCount + 1})`;

        const ratingRef = doc(db, "ratings", gameTitle);
        try {
          const newCount = await runTransaction(db, async (transaction) => {
            const ratingDoc = await transaction.get(ratingRef);
            if (!ratingDoc.exists()) {
              await setDoc(ratingRef, {
                totalRating: Number(rating),
                count: 1,
              });
              return 1;
            } else {
              const newTotalRating =
                ratingDoc.data().totalRating + Number(rating);
              const newCount = ratingDoc.data().count + 1;
              transaction.update(ratingRef, {
                totalRating: newTotalRating,
                count: newCount,
              });
              return newCount;
            }
          });
          numRatingsElement.textContent = `(${newCount})`; // Update the counter to the actual new count
        } catch (error) {
          console.error("Failed to update rating:", error);
          numRatingsElement.textContent = `(${currentCount})`; // Revert to the original count if there was an error
        }
      }

      async function fetchRating(gameTitle) {
        const ratingRef = doc(db, "ratings", gameTitle);
        const ratingSnap = await getDoc(ratingRef);
        if (ratingSnap.exists()) {
          const gameTitleId = gameTitle.split(" ").join("-");
          const numRatingsElement = document.getElementById(
            "numRatings-" + gameTitleId
          );
          if (numRatingsElement) {
            numRatingsElement.textContent = `(${ratingSnap.data().count})`;
          }
          return Math.round(
            ratingSnap.data().totalRating / ratingSnap.data().count
          );
        }
        return 0;
      }

      async function setRatingStars(gameTitle) {
        let gameTitleId = gameTitle.split(" ").join("-");
        let rating = await fetchRating(gameTitle).catch(console.error);
        let i;
        for (i = rating; i > 0; i--) {
          let starElement = document.getElementById(
            "star" + i + "-" + gameTitleId
          );
          if (starElement) {
            starElement.className = "fa fa-star checked";
          }
        }
      }

      window.rate = rate;
      window.onload = function () {
        setRatingStars("Avowed");
        setRatingStars("Starfield");
        setRatingStars("Clockwork Revolution");
      };
    </script>
  </body>
</html>
